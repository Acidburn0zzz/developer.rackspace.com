# Upstart script for the Jekyll site source watcher.
#
# {{ ansible_managed }}

pre-start script
  mkdir -p /var/log/jekyll/
end script

respawn

start on runlevel [2345]
stop on runlevel [06]

script
  export LANG=en_US.UTF-8
  export LC_ALL=en_US.UTF-8
  exec start-stop-daemon --start --chuid publisher \
    --chdir /vagrant_data/site_source \
    --exec /usr/local/bin/jekyll \
    'build --watch --verbose \
    --source . \
    --destination /var/www/html/developer.rackspace.com/ \
    2>/var/log/jekyll/site_source.err \
    >/var/log/jekyll/site_source.out'
end script
